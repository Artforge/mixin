/*
 mixin_auto_memory.js
 (c) 2011 Kevin Malakoff.
 Mixin.AutoMemory is freely distributable under the MIT license.
 See the following for full license details:
 https://github.com/kmalakoff/mixin/blob/master/LICENSE
 Dependencies: Mixin.Core, Underscore.js, Underscore-Awesomer.js
*/
if(!Mixin&&(typeof exports!=="undefined")){this.Mixin=require("mixin_core").Mixin}if(!Mixin){throw new Error("Mixin.AutoMemory: Dependency alert! Mixin is missing. Please ensure it is included")}if(!_.VERSION){throw new Error("Mixin.AutoMemory: Dependency alert! Underscore.js must be included before this file")}if(!_.AWESOMENESS){throw new Error("Mixin.AutoMemory: Dependency alert! Underscore-Awesomer.js must be included before this file")}Mixin.AutoMemory||(Mixin.AutoMemory={});Mixin.AutoMemory.root=this;Mixin.AutoMemory.WRAPPER=Mixin.AutoMemory.root["$"]?$:"$";Mixin.AutoMemory.Property=(function(){function a(b,e,f,d){var h,c,g;this.owner=b;this.key=e;this.fn_ref=f;this.args=d;if(!Mixin.DEBUG){return this}if(!this.key){throw new Error("Mixin.AutoMemory: missing key")}if(_.isArray(this.key)){g=this.key;for(h=0,c=g.length;h<c;h++){e=g[h];if(!_.keypathExists(this.owner,e)){throw new Error("Mixin.AutoMemory: property '"+e+"' doesn't exist on '"+(_.className(this.owner))+"'")}}}else{if(!_.keypathExists(this.owner,this.key)){throw new Error("Mixin.AutoMemory: property '"+this.key+"' doesn't exist on '"+(_.className(this.owner))+"'")}}if(this.fn_ref&&!(_.isFunction(this.fn_ref)||_.isString(this.fn_ref))){throw new Error("Mixin.AutoMemory: unexpected function reference for property '"+this.key+"' on '"+(_.className(this.owner))+"'")}}a.prototype.destroy=function(){var d,f,c,e,b;if(_.isArray(this.key)){e=this.key;b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(this._destroyKey(d))}return b}else{return this._destroyKey(this.key)}};a.prototype._destroyKey=function(b){var c;if(!this.fn_ref){_.keypath(this.owner,b,null);return}c=_.keypath(this.owner,b);if(!c){return}if(_.isFunction(this.fn_ref)){this.fn_ref.apply(this.owner,[c].concat(this.args?this.args.slice():[]))}else{if(Mixin.DEBUG&&!_.isFunction(c[this.fn_ref])){throw new Error("Mixin.AutoMemory: function '"+this.fn_ref+"' missing for property '"+b+"' on '"+(_.className(this.owner))+"'")}if(_.isFunction(c[this.fn_ref])){c[this.fn_ref].apply(c,this.args)}}return _.keypath(this.owner,b,null)};return a})();Mixin.AutoMemory.WrappedProperty=(function(){function a(b,d,e,h){var g,c,f;this.owner=b;this.key=d;this.fn_ref=e;this.wrapper=h;if(this.fn_ref&&_.isArray(this.fn_ref)){if(Mixin.DEBUG&&!this.fn_ref.length){throw new Error("Mixin.AutoMemory: unexpected function reference")}this.args=this.fn_ref.splice(1);this.fn_ref=this.fn_ref[0]}if(!Mixin.DEBUG){return this}if(!this.key){throw new Error("Mixin.AutoMemory: missing key")}if(_.isArray(this.key)){f=this.key;for(g=0,c=f.length;g<c;g++){d=f[g];if(!_.keypathExists(this.owner,d)){throw new Error("Mixin.AutoMemory: property '"+d+"' doesn't exist on '"+(_.className(this.owner))+"'")}}}else{if(!_.keypathExists(this.owner,this.key)){throw new Error("Mixin.AutoMemory: property '"+this.key+"' doesn't exist on '"+(_.className(this.owner))+"'")}}if(this.fn_ref&&!(_.isFunction(this.fn_ref)||_.isString(this.fn_ref))){throw new Error("Mixin.AutoMemory: unexpected function reference")}if(!this.wrapper){throw new Error("Mixin.AutoMemory: missing wrapper")}}a.prototype.destroy=function(){var d,f,c,e,b;if(_.isArray(this.key)){e=this.key;b=[];for(f=0,c=e.length;f<c;f++){d=e[f];b.push(this._destroyKey(d))}return b}else{return this._destroyKey(this.key)}};a.prototype._destroyKey=function(b){var d,c,e;if(!this.fn_ref){_.keypath(this.owner,b,null);return}d=_.keypath(this.owner,b);if(!d){return}e=_.isString(this.wrapper)?Mixin.AutoMemory.root[this.wrapper]:this.wrapper;c=e(d);if(_.isFunction(this.fn_ref)){this.fn_ref.apply(this.owner,[c].concat(this.args?this.args.slice():[]))}else{if(Mixin.DEBUG&&!_.isFunction(c[this.fn_ref])){throw new Error("Mixin.AutoMemory: function '"+this.fn_ref+"' missing for wrapped property '"+b+"' on '"+(_.className(this.owner))+"'")}c[this.fn_ref].apply(c,this.args)}return _.keypath(this.owner,b,null)};return a})();Mixin.AutoMemory.Function=(function(){function a(c,d,b){this.object=c;this.fn_ref=d;this.args=b;if(!Mixin.DEBUG){return this}if(!this.fn_ref){throw new Error("Mixin.AutoMemory: missing fn_ref")}if(!_.isFunction(this.fn_ref)&&!(this.object&&_.isString(this.fn_ref)&&_.isFunction(this.object[this.fn_ref]))){throw new Error("Mixin.AutoMemory: unexpected function reference")}}a.prototype.destroy=function(){if(!this.object){this.fn_ref.apply(null,this.args);return}if(!_.isFunction(this.fn_ref)){this.object[this.fn_ref].apply(this.object,this.args);return}return this.fn_ref.apply(this.object,[this.object].concat(this.args?this.args.slice():[]))};return a})();Mixin.AutoMemory._mixin_info={mixin_name:"AutoMemory",initialize:function(){return Mixin.instanceData(this,"AutoMemory",[])},destroy:function(){var e,c,d,b,a;c=Mixin.instanceData(this,"AutoMemory");Mixin.instanceData(this,"AutoMemory",[]);a=[];for(d=0,b=c.length;d<b;d++){e=c[d];a.push(e.destroy())}return a},mixin_object:{autoProperty:function(a,b){Mixin.instanceData(this,"AutoMemory").push(new Mixin.AutoMemory.Property(this,a,b,Array.prototype.slice.call(arguments,2)));return this},autoWrappedProperty:function(a,b,c){if(c===void 0){c=Mixin.AutoMemory.WRAPPER}Mixin.instanceData(this,"AutoMemory").push(new Mixin.AutoMemory.WrappedProperty(this,a,b,c));return this},autoFunction:function(a,b){Mixin.instanceData(this,"AutoMemory").push(new Mixin.AutoMemory.Function(a,b,Array.prototype.slice.call(arguments,2)));return this}}};Mixin.registerMixin(Mixin.AutoMemory._mixin_info);