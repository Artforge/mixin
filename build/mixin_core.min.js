/*
 mixin.js 0.1.0
 (c) 2011 Kevin Malakoff.
 Mixin is freely distributable under the MIT license.
 See the following for full license details:
 https://github.com/kmalakoff/mixin/blob/master/LICENSE
 Dependencies: None.
 - Dependencies with Mixin.UNMIX_ON_BACKBONE_DESTROY enabled: Underscore.js, Backbone.js

 Note: some code from Underscore.js is embedded in this file
 to remove dependencies on the full library. Please see the following for details
 on Underscore.js and its licensing:
 https://github.com/documentcloud/underscore
 https://github.com/documentcloud/underscore/blob/master/LICENSE
*/
var _;var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d};this.Mixin||(this.Mixin={});this.Mixin.Core||(this.Mixin.Core={});Mixin.VERSION="0.1.1";_||(_={});if(!_.isArray){_.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"}}if(!_.isString){_.isString=function(a){return !!(a===""||(a&&a.charCodeAt&&a.substr))}}if(!_.isFunction){_.isFunction=function(a){return !!(a&&a.constructor&&a.call&&a.apply)}}if(!_.isEmpty){_.isEmpty=function(c){var a,b;if(_.isArray(c)||_.isString(c)){return c.length===0}for(a in c){b=c[a];return false}return true}}if(!_.classOf){_.classOf=function(a){if(!(a instanceof Object)){return}if(a.prototype&&a.prototype.constructor&&a.prototype.constructor.name){return a.prototype.constructor.name}if(a.constructor&&a.constructor.name){return a.constructor.name}}}if(!_.size){_.size=function(c){var b,a;b=0;for(a in c){b++}return b}}if(!_.find){_.find=function(e,b){var c,d,a;for(d=0,a=e.length;d<a;d++){c=e[d];if(b(c)){return c}}return null}}Mixin.Core._Validate=(function(){function a(){}a.mixinInfo=function(b,d,c){if(!b){throw new Error(""+c+": mixin_info missing")}a.string(b.mixin_name,c,"mixin_name");if(!d&&Mixin.Core._Manager.available_mixins.hasOwnProperty(b.mixin_name)){throw new Error(""+c+": mixin_info '"+b.mixin_name+"' already registered")}if(!b.mixin_object){throw new Error(""+c+": mixin_info '"+b.mixin_name+"' missing mixin_object")}if(!(b.mixin_object instanceof Object)){throw new Error(""+c+": mixin_info '"+b.mixin_name+"' mixin_object is invalid")}if(b.initialize&&!_.isFunction(b.initialize)){throw new Error(""+c+": mixin_info '"+b.mixin_name+"' initialize function is invalid")}if(b.destroy&&!_.isFunction(b.destroy)){throw new Error(""+c+": mixin_info '"+b.mixin_name+"' destroy function is invalid")}};a.instanceAndMixinName=function(c,d,b){if(!c){throw new Error(""+b+": mix_target missing")}a.string(d,b,"mixin_name");return a.instanceOrArray(c,b,"mix_target",d)};a.classConstructorAndMixinName=function(c,d,b){if(!c){throw new Error(""+b+": class constructor missing")}a.string(d,b,"mixin_name");if(!_.isFunction(c)){throw new Error(""+b+": class constructor invalid for '"+d+"'")}};a.exists=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}};a.object=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}if((typeof d!=="object")||_.isArray(d)){throw new Error(""+b+": "+c+" invalid")}};a.uint=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}if(!(typeof d!=="number")||(d<0)||(Math.floor(d)!==d)){throw new Error(""+b+": "+c+" invalid")}};a.string=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}if(!_.isString(d)){throw new Error(""+b+": "+c+" invalid")}};a.stringArrayOrNestedStringArray=function(h,d,e){var f,g,c,b;if(h===void 0){throw new Error(""+d+": "+e+" missing")}if(!_.isArray(h)){throw new Error(""+d+": "+e+" invalid")}b=[];for(g=0,c=string_or_array.length;g<c;g++){f=string_or_array[g];b.push(((function(){if(_.isArray(f)&&(!f.length||!_.isString(f[0]))||!_.isString(f)){throw new Error(""+d+": "+e+" invalid")}})()))}return b};a.callback=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}if(!_.isFunction(d)){throw new Error(""+b+": "+c+" invalid")}};a.instance=function(d,b,c){if(d===void 0){throw new Error(""+b+": "+c+" missing")}if((typeof d!=="object"||_.isArray(d))||!_.isFunction(d.constructor)||(d.constructor.name==="Object")){throw new Error(""+b+": "+c+" invalid")}};a.instanceOrArray=function(e,b,c,d){if(e===void 0){throw new Error(""+b+": "+c+" missing")}if((typeof e!=="object")||!_.isFunction(e.constructor)||(e.constructor.name==="Object")||_.isArray(e)){throw new Error(""+b+": "+c+" invalid")}};a.instanceWithMixin=function(e,d,b,c){a.instance(e,b,c);if(!Mixin.hasMixin(e,d)){throw new Error(""+b+": "+c+" missing mixin '"+d+"' on "+(_.classOf(e)))}};a.noKey=function(e,d,b,c){if(e.hasOwnProperty(d)){throw new Error(""+b+": "+d+" already exists for "+c)}};a.hasKey=function(e,d,b,c){if(!e.hasOwnProperty(d)){throw new Error(""+b+": "+d+" does not exist for "+c)}};return a})();Mixin.Core._InstanceRecord=(function(){function a(b){this.mix_target=b;this.initialized_mixins={}}a.prototype.destroy=function(){if(!_.isEmpty(this.initialized_mixins)){throw new Error("Mixin: non-empty instance record being destroyed")}if(this.backbone_destroy_fn){this.mix_target.unbind("destroy",this.backbone_destroy_fn);this.backbone_destroy_fn=null}return this.mix_target=null};a.prototype.hasMixin=function(d,c){var b;b=this.initialized_mixins.hasOwnProperty(d);if(b||!c){return b}this.initialized_mixins[d]={is_destroyed:false};if(Mixin.UNMIX_ON_BACKBONE_DESTROY&&(mixin_info.mixin_name==="Backbone.Events")&&!this.backbone_destroy_fn){this.backbone_destroy_fn=this._bindBackboneDestroyFn(this.mix_target);this.mix_target.bind("destroy",this.backbone_destroy_fn)}return true};a.prototype.collectMixins=function(d){var e,c,f,b;f=this.initialized_mixins;b=[];for(e in f){c=f[e];b.push(d.push(e))}return b};a.prototype.initializeMixin=function(b,c){this.initialized_mixins[b.mixin_name]={is_destroyed:false,destroy:b.destroy};if(b.initialize){b.initialize.apply(this.mix_target,c)}if(Mixin.UNMIX_ON_BACKBONE_DESTROY&&(b.mixin_name==="Backbone.Events")&&!this.backbone_destroy_fn){this.backbone_destroy_fn=this._bindBackboneDestroyFn(this.mix_target);return this.mix_target.bind("destroy",this.backbone_destroy_fn)}};a.prototype.destroyMixin=function(f){var c,b,e,d;if(f){if(!this.initialized_mixins.hasOwnProperty(f)){return false}return this._destroyMixinInfo(f)}else{b=false;d=this.initialized_mixins;for(c in d){e=d[c];b=true;this._destroyMixinInfo(c)}return b}};a.prototype._destroyMixinInfo=function(c){var b;b=this.initialized_mixins[c];if(b.is_destroyed){return true}b.is_destroyed=true;if(b.destroy){b.destroy.apply(this.mix_target);b.destroy=null}Mixin.Core._Manager._destroyInstanceData(this.mix_target,c);delete this.initialized_mixins[c];return true};a.prototype._bindBackboneDestroyFn=function(b){return __bind(function(){return Mixin.out(b)},this)};return a})();Mixin.Core._ClassRecord=(function(){function a(b){this.constructor=b;this.mixins={};this.instance_records=[]}a.prototype.mixIntoClass=function(d,b){var c,f,e;if(this.mixins.hasOwnProperty(b.mixin_name)){return}this.mixins[b.mixin_name]=b;if(!b.force){e=b.mixin_object;for(c in e){f=e[c];if(c in d){throw new Error("Mixin: property '"+c+"' clashes with existing property on '"+(_.classOf(d)))}}}return __extends(d.constructor.prototype,b.mixin_object)};a.prototype.classHasMixin=function(b){return this.mixins.hasOwnProperty(b)};a.prototype.instanceHasMixin=function(c,e,d){var b;b=this._getInstanceRecord(c);if(d){if(!this.mixins.hasOwnProperty(e)){this.mixins[e]=Mixin.Core._Manager._getMixinInfo(e)}if(!b){b=new Mixin.Core._InstanceRecord(c);this.instance_records.push(b)}return b.hasMixin(e,d)}else{if(b){return b.hasMixin(e)}else{return false}}};a.prototype.collectMixinsForInstance=function(b,d){var c;c=this._getInstanceRecord(d);if(!c){return}return c.collectMixins(b)};a.prototype.initializeInstance=function(e,b,d){var c;c=this._getInstanceRecord(e);if(c){c.initializeMixin(b,d);return}c=new Mixin.Core._InstanceRecord(e);this.instance_records.push(c);return c.initializeMixin(b,d)};a.prototype.destroyInstance=function(e,f){var d,c,b;if(f&&!this.mixins.hasOwnProperty(f)){return false}b=false;d=this.instance_records.length-1;while(d>=0){c=this.instance_records[d];if((c.mix_target===e)&&c.destroyMixin(f)){b=true;if(_.isEmpty(c.initialized_mixins)){c.destroy();this.instance_records.splice(d,1)}if(f){return true}}d--}return b};a.prototype._getInstanceRecord=function(d){var c,f,b,e;e=this.instance_records;for(f=0,b=e.length;f<b;f++){c=e[f];if(c.mix_target===d){return c}}};return a})();Mixin.Core._Manager=(function(){function a(){}a.available_mixins={};a.registerMixin=function(b,c){if(Mixin.DEBUG){Mixin.Core._Validate.mixinInfo(b,c,"Mixin.registerMixin")}a.available_mixins[b.mixin_name]=b;return true};a.isAvailable=function(b){return a.available_mixins.hasOwnProperty(b)};a._getMixinInfo=function(b){return a.available_mixins[b]};a.mixin=function(e){var d,h,g,c,f,b;c=__bind(function(k,l,m){var j,i;if(Mixin.DEBUG){Mixin.Core._Validate.instanceAndMixinName(k,l,"Mixin.mixin","mix_target");if(!this.isAvailable(l)){throw new Error("Mixin.mixin: '"+l+"' not found")}}i=a.available_mixins[l];if(!i){throw new Error("Mixin.mixin: '"+l+"' not found")}if(this.hasMixin(k,i.mixin_name)){return}j=a._findOrCreateClassRecord(k,i);j.mixIntoClass(k,i);return j.initializeInstance(k,i,Array.prototype.slice.call(arguments,2))},this);d=Array.prototype.slice.call(arguments,1);if(!d.length){throw new Error("Mixin: mixin_name missing")}if(d.length>1){h=d[1];if(!((_.isString(h)&&a.isAvailable(h))||(_.isArray(h)&&(h.length>=1)&&_.isString(h[0])&&a.isAvailable(h[0])))){c.apply(this,arguments);return e}}for(f=0,b=d.length;f<b;f++){g=d[f];if(_.isArray(g)){c.apply(this,[e].concat(g))}else{c(e,g)}}return e};a.mixout=function(i,e){var h,k,l,f,d,j,b,g,c;if(Mixin.DEBUG){Mixin.Core._Validate.instance(i,"Mixin.mixout","mix_target")}l=__bind(function(o,r){var n,q,m,p;if(Mixin.DEBUG){Mixin.Core._Validate.string(r,"Mixin.mixout","mixin_name")}if(o.constructor._mixin_class_records){p=o.constructor._mixin_class_records;for(q=0,m=p.length;q<m;q++){n=p[q];if(n.destroyInstance(o,r)){return o}}}return o},this);if(arguments.length>1){g=Array.prototype.slice.call(arguments,1);for(f=0,j=g.length;f<j;f++){k=g[f];l(i,k)}}else{if(i.constructor._mixin_class_records){c=i.constructor._mixin_class_records;for(d=0,b=c.length;d<b;d++){h=c[d];if(h.destroyInstance(i)){return i}}}}return i};a.hasMixin=function(d,f,e){var c,b;if(e){if(a.hasMixin(d,f)){return true}b=a.available_mixins[f];if(!b){return false}c=a._findOrCreateClassRecord(d,b);return c.instanceHasMixin(d,f,e)}else{if(Mixin.DEBUG){Mixin.Core._Validate.instanceAndMixinName(d,f,"Mixin.hasMixin","mix_target")}if(a.hasInstanceData(d,f)){return true}c=a._findClassRecord(d,f);if(!c){return false}return c.instanceHasMixin(d,f)}};a.mixins=function(e){var d,c,g,b,f;if(Mixin.DEBUG){Mixin.Core._Validate.instance(e,c,"Mixin.mixins","mix_target")}c=[];if(e.constructor._mixin_class_records){f=e.constructor._mixin_class_records;for(g=0,b=f.length;g<b;g++){d=f[g];d.collectMixinsForInstance(c,e)}}return c};a._getClassRecords=function(e){var d,h,c,g,b,f;h=[];c=e.constructor;while(c){if(c._mixin_class_records){f=c._mixin_class_records;for(g=0,b=f.length;g<b;g++){d=f[g];if(e instanceof d.constructor){h.push(d)}}}c=c.__super__&&(c.__super__.constructor!==c)?c.__super__.constructor:void 0}return h};a._findClassRecord=function(d,f){var c,g,e,b;g=this._getClassRecords(d);for(e=0,b=g.length;e<b;e++){c=g[e];if(c.classHasMixin(f)){return c}}};a._findOrCreateClassRecord=function(g,d){var f,e,c,b,h;f=a._findClassRecord(g,d.mixin_name);if(f){return f}if(g.constructor._mixin_class_records){f=_.find(g.constructor._mixin_class_records,function(i){return i.constructor===g.constructor})}if(!f){f=new Mixin.Core._ClassRecord(g.constructor);if(g.constructor._mixin_class_records){h=false;e=0;c=g.constructor._mixin_class_records.length;while(e<c){b=g.constructor._mixin_class_records[e];if(g instanceof b.constructor){g.constructor._mixin_class_records.splice(e,0,f);h=true;break}e++}if(!h){g.constructor._mixin_class_records.push(f)}}else{g.constructor._mixin_class_records=[f]}if(Mixin._statistics){Mixin._statistics.addClassRecord(f)}}return f};a.hasInstanceData=function(b,c){if(Mixin.DEBUG){Mixin.Core._Validate.instanceAndMixinName(b,c,"Mixin.hasInstanceData","mix_target")}return !!(b._mixin_data&&b._mixin_data.hasOwnProperty(c))};a.instanceData=function(b,d,c){if(Mixin.DEBUG){Mixin.Core._Validate.instanceAndMixinName(b,d,"Mixin.instanceData","mix_target");if(c===void 0){if(!("_mixin_data" in b)){throw new Error("Mixin.instanceData: no instance data on '"+(_.classOf(b))+"'")}if(!b._mixin_data.hasOwnProperty(d)){throw new Error("Mixin.instanceData: mixin '"+d+"' instance data not found on '"+(_.classOf(b))+"'")}}else{if(!a.hasMixin(b,d)){throw new Error("Mixin.instanceData: mixin '"+d+"' not mixed into '"+(_.classOf(b))+"'")}}}if(!(c===void 0)){if(!b._mixin_data){b._mixin_data={}}b._mixin_data[d]=c}return b._mixin_data[d]};a._destroyInstanceData=function(b,d){var c;if(!b._mixin_data){return}c=b._mixin_data[d];delete b._mixin_data[d];if(_.isEmpty(b._mixin_data)){return delete b._mixin_data}};return a})();Mixin.registerMixin=Mixin.Core._Manager.registerMixin;Mixin.isAvailable=Mixin.Core._Manager.isAvailable;Mixin.mixin=Mixin["in"]=Mixin.Core._Manager.mixin;Mixin.mixout=Mixin.out=Mixin.Core._Manager.mixout;Mixin.hasMixin=Mixin.exists=Mixin.Core._Manager.hasMixin;Mixin.mixins=Mixin.Core._Manager.mixins;Mixin.hasInstanceData=Mixin.hasID=Mixin.Core._Manager.hasInstanceData;Mixin.instanceData=Mixin.iD=Mixin.Core._Manager.instanceData;if(typeof exports!=="undefined"){exports.Mixin=Mixin}if(!Mixin&&(typeof exports!=="undefined")){this.Mixin=require("mixin_core").Mixin}if(!Mixin){throw new Error("Mixin.Core.Statistics: Dependency alert! Mixin is missing. Please ensure it is included")}if(this.Mixin.STATISTICS===void 0){this.Mixin.STATISTICS=true}Mixin.Core.Statistics=(function(){function a(){this.class_records=[]}a.prototype.addClassRecord=function(b){return this.class_records.push(b)};a.prototype.purge=function(){this.class_records=[];return this.clear()};a.prototype.clear=function(){this.by_instance_with_data=null;this.by_instance_get_mixins=null;this.by_mixin_get_instances=null;this.by_mixin_get_constructors=null;return this.by_constructor_get_instances=null};a.prototype.update=function(){this.clear();this.byInstance_getMixins();this.byInstance_withData();this.byMixin_getInstances();this.byMixin_getConstructors();return this.byConstructor_getInstances()};a.prototype.byInstance_getMixins=function(){var c,e,b,d;if(!this.by_instance_get_mixins){this.by_instance_get_mixins=[];d=this.class_records;for(e=0,b=d.length;e<b;e++){c=d[e];this.classRecordGetMixinsByInstance(c,this.by_instance_get_mixins)}}return this.by_instance_get_mixins};a.prototype.byInstance_withData=function(){var c,e,b,d;if(!this.by_instance_with_data){this.by_instance_with_data=[];d=this.class_records;for(e=0,b=d.length;e<b;e++){c=d[e];this.classRecordGetInstancesWithData(c,this.by_instance_with_data)}}return this.by_instance_with_data};a.prototype.byMixin_getInstances=function(){var c,e,b,d;if(!this.by_mixin_get_instances){this.by_mixin_get_instances={};d=this.class_records;for(e=0,b=d.length;e<b;e++){c=d[e];this.classRecordGetInstancesByMixin(c,this.by_mixin_get_instances)}}return this.by_mixin_get_instances};a.prototype.byMixin_getConstructors=function(){var c,e,b,d;if(!this.by_mixin_get_constructors){this.by_mixin_get_constructors={};d=this.class_records;for(e=0,b=d.length;e<b;e++){c=d[e];this.classRecordGetMixins(c,this.by_mixin_get_constructors)}}return this.by_mixin_get_constructors};a.prototype.byConstructor_getInstances=function(){var c,e,b,d;if(!this.by_constructor_get_instances){this.by_constructor_get_instances={};d=this.class_records;for(e=0,b=d.length;e<b;e++){c=d[e];this.classRecordGroupInstances(c,this.by_constructor_get_instances)}}return this.by_constructor_get_instances};a.prototype.classRecordGetInstancesWithData=function(e,h){var d,g,c,f,b;f=e.instance_records;b=[];for(g=0,c=f.length;g<c;g++){d=f[g];b.push((d.mix_target&&d.mix_target._mixin_data?h.push(d.mix_target):void 0))}return b};a.prototype.classRecordGetInstancesByMixin=function(f,g){var j,i,b,d,h,e,c;if(!f.instance_records.length){return}e=f.instance_records;c=[];for(d=0,h=e.length;d<h;d++){j=e[d];c.push((function(){var l,k;l=j.initialized_mixins;k=[];for(i in l){b=l[i];k.push((!g.hasOwnProperty(i)?g[i]=[]:void 0,g[i].push(j.mix_target)))}return k})())}return c};a.prototype.classRecordGetMixinsByInstance=function(h,b){var l,k,c,i,f,j,g,d,e;g=h.instance_records;e=[];for(f=0,j=g.length;f<j;f++){l=g[f];i=[];d=l.initialized_mixins;for(k in d){c=d[k];i.push(k)}e.push(b.push({instance:l.mix_target,mixins:i}))}return e};a.prototype.classRecordGroupInstances=function(e,h){var d,g,c,f,b;if(!e.instance_records.length){return}if(!h.hasOwnProperty(e.constructor.name)){h[e.constructor]=[]}f=e.instance_records;b=[];for(g=0,c=f.length;g<c;g++){d=f[g];b.push(h[e.constructor].push(d.mix_target))}return b};a.prototype.classRecordGetMixins=function(g,d,e){var f,c,h,b;h=g.mixins;b=[];for(f in h){c=h[f];b.push((!d.hasOwnProperty(f)?d[f]=[]:void 0,d[f].push(g.constructor)))}return b};return a})();if(this.Mixin.STATISTICS){Mixin._statistics=new Mixin.Core.Statistics()};